{"ast":null,"code":"import { StorageAction } from '@aws-amplify/core/internals/utils';\nimport { CanceledError } from '../../../errors/CanceledError.mjs';\nimport './client/s3data/base.mjs';\nimport './client/s3data/getObject.mjs';\nimport { listObjectsV2 } from './client/s3data/listObjectsV2.mjs';\nimport './client/s3data/putObject.mjs';\nimport './client/s3data/createMultipartUpload.mjs';\nimport './client/s3data/uploadPart.mjs';\nimport './client/s3data/completeMultipartUpload.mjs';\nimport './client/s3data/listParts.mjs';\nimport './client/s3data/abortMultipartUpload.mjs';\nimport './client/s3data/copyObject.mjs';\nimport './client/s3data/headObject.mjs';\nimport './client/s3data/deleteObject.mjs';\nimport { deleteObjects } from './client/s3data/deleteObjects.mjs';\nimport { getStorageUserAgentValue } from './userAgent.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst MAX_KEYS_PER_BATCH = 1000;\n/**\n * Deletes all contents of a folder in S3 using batch operations\n *\n * @param params - Configuration object for the delete operation\n * @returns Promise that resolves to the removal result\n */\nconst deleteFolderContents = async params => {\n  const {\n    s3Config,\n    bucket,\n    folderKey,\n    expectedBucketOwner,\n    onProgress,\n    abortSignal\n  } = params;\n  try {\n    const prefix = folderKey.endsWith('/') ? folderKey : `${folderKey}/`;\n    const progressCallback = onProgress ?? (() => {\n      // no-op\n    });\n    let continuationToken;\n    do {\n      if (abortSignal?.aborted) {\n        throw new CanceledError({\n          message: 'Operation was canceled'\n        });\n      }\n      const listResult = await listObjectsV2({\n        ...s3Config,\n        userAgentValue: getStorageUserAgentValue(StorageAction.Remove),\n        abortSignal\n      }, {\n        Bucket: bucket,\n        Prefix: prefix,\n        MaxKeys: MAX_KEYS_PER_BATCH,\n        ContinuationToken: continuationToken,\n        ExpectedBucketOwner: expectedBucketOwner\n      });\n      if (!listResult.Contents || listResult.Contents.length === 0) {\n        break;\n      }\n      if (abortSignal?.aborted) {\n        throw new CanceledError({\n          message: 'Operation was canceled'\n        });\n      }\n      const batch = listResult.Contents.map(obj => ({\n        Key: obj.Key\n      }));\n      const deleteResult = await deleteObjects({\n        ...s3Config,\n        userAgentValue: getStorageUserAgentValue(StorageAction.Remove),\n        abortSignal\n      }, {\n        Bucket: bucket,\n        Delete: {\n          Objects: batch,\n          Quiet: false\n        },\n        ExpectedBucketOwner: expectedBucketOwner\n      });\n      const deleted = deleteResult.Deleted?.map(obj => ({\n        path: obj.Key\n      })) || [];\n      const failed = deleteResult.Errors?.map(err => ({\n        path: err.Key,\n        code: err.Code,\n        message: err.Message\n      })) || [];\n      progressCallback({\n        deleted,\n        failed\n      });\n      continuationToken = listResult.NextContinuationToken;\n    } while (continuationToken);\n    return {\n      path: folderKey\n    };\n  } catch (error) {\n    if (abortSignal?.aborted) {\n      throw new CanceledError({\n        message: 'Operation was canceled'\n      });\n    }\n    throw error;\n  }\n};\nexport { deleteFolderContents };","map":{"version":3,"names":["MAX_KEYS_PER_BATCH","deleteFolderContents","params","s3Config","bucket","folderKey","expectedBucketOwner","onProgress","abortSignal","prefix","endsWith","progressCallback","continuationToken","aborted","CanceledError","message","listResult","listObjectsV2","userAgentValue","getStorageUserAgentValue","StorageAction","Remove","Bucket","Prefix","MaxKeys","ContinuationToken","ExpectedBucketOwner","Contents","length","batch","map","obj","Key","deleteResult","deleteObjects","Delete","Objects","Quiet","deleted","Deleted","path","failed","Errors","err","code","Code","Message","NextContinuationToken","error"],"sources":["/Users/mohamedhazin/Desktop/filevalut/frontend/node_modules/@aws-amplify/storage/src/providers/s3/utils/deleteFolderContents.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { StorageAction } from '@aws-amplify/core/internals/utils';\nimport { CanceledError } from '../../../errors/CanceledError';\nimport { deleteObjects, listObjectsV2 } from './client/s3data';\nimport { getStorageUserAgentValue } from './userAgent';\nconst MAX_KEYS_PER_BATCH = 1000;\n/**\n * Deletes all contents of a folder in S3 using batch operations\n *\n * @param params - Configuration object for the delete operation\n * @returns Promise that resolves to the removal result\n */\nexport const deleteFolderContents = async (params) => {\n    const { s3Config, bucket, folderKey, expectedBucketOwner, onProgress, abortSignal, } = params;\n    try {\n        const prefix = folderKey.endsWith('/') ? folderKey : `${folderKey}/`;\n        const progressCallback = onProgress ??\n            (() => {\n                // no-op\n            });\n        let continuationToken;\n        do {\n            if (abortSignal?.aborted) {\n                throw new CanceledError({ message: 'Operation was canceled' });\n            }\n            const listResult = await listObjectsV2({\n                ...s3Config,\n                userAgentValue: getStorageUserAgentValue(StorageAction.Remove),\n                abortSignal,\n            }, {\n                Bucket: bucket,\n                Prefix: prefix,\n                MaxKeys: MAX_KEYS_PER_BATCH,\n                ContinuationToken: continuationToken,\n                ExpectedBucketOwner: expectedBucketOwner,\n            });\n            if (!listResult.Contents || listResult.Contents.length === 0) {\n                break;\n            }\n            if (abortSignal?.aborted) {\n                throw new CanceledError({ message: 'Operation was canceled' });\n            }\n            const batch = listResult.Contents.map(obj => ({ Key: obj.Key }));\n            const deleteResult = await deleteObjects({\n                ...s3Config,\n                userAgentValue: getStorageUserAgentValue(StorageAction.Remove),\n                abortSignal,\n            }, {\n                Bucket: bucket,\n                Delete: {\n                    Objects: batch,\n                    Quiet: false,\n                },\n                ExpectedBucketOwner: expectedBucketOwner,\n            });\n            const deleted = deleteResult.Deleted?.map(obj => ({ path: obj.Key })) || [];\n            const failed = deleteResult.Errors?.map(err => ({\n                path: err.Key,\n                code: err.Code,\n                message: err.Message,\n            })) || [];\n            progressCallback({ deleted, failed });\n            continuationToken = listResult.NextContinuationToken;\n        } while (continuationToken);\n        return { path: folderKey };\n    }\n    catch (error) {\n        if (abortSignal?.aborted) {\n            throw new CanceledError({ message: 'Operation was canceled' });\n        }\n        throw error;\n    }\n};\n"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AAKA,MAAMA,kBAAkB,GAAG,IAAI;AAC/B;AACA;AACA;AACA;AACA;AACA;AACY,MAACC,oBAAoB,GAAG,MAAOC,MAAM,IAAK;EAClD,MAAM;IAAEC,QAAQ;IAAEC,MAAM;IAAEC,SAAS;IAAEC,mBAAmB;IAAEC,UAAU;IAAEC;EAAW,CAAG,GAAGN,MAAM;EAC7F,IAAI;IACA,MAAMO,MAAM,GAAGJ,SAAS,CAACK,QAAQ,CAAC,GAAG,CAAC,GAAGL,SAAS,GAAG,GAAGA,SAAS,GAAG;IACpE,MAAMM,gBAAgB,GAAGJ,UAAU,KAC9B,MAAM;MACnB;IAAA,CACa,CAAC;IACN,IAAIK,iBAAiB;IACrB,GAAG;MACC,IAAIJ,WAAW,EAAEK,OAAO,EAAE;QACtB,MAAM,IAAIC,aAAa,CAAC;UAAEC,OAAO,EAAE;QAAwB,CAAE,CAAC;MAClE;MACA,MAAMC,UAAU,GAAG,MAAMC,aAAa,CAAC;QACnC,GAAGd,QAAQ;QACXe,cAAc,EAAEC,wBAAwB,CAACC,aAAa,CAACC,MAAM,CAAC;QAC9Db;MAChB,CAAa,EAAE;QACCc,MAAM,EAAElB,MAAM;QACdmB,MAAM,EAAEd,MAAM;QACde,OAAO,EAAExB,kBAAkB;QAC3ByB,iBAAiB,EAAEb,iBAAiB;QACpCc,mBAAmB,EAAEpB;MACrC,CAAa,CAAC;MACF,IAAI,CAACU,UAAU,CAACW,QAAQ,IAAIX,UAAU,CAACW,QAAQ,CAACC,MAAM,KAAK,CAAC,EAAE;QAC1D;MACJ;MACA,IAAIpB,WAAW,EAAEK,OAAO,EAAE;QACtB,MAAM,IAAIC,aAAa,CAAC;UAAEC,OAAO,EAAE;QAAwB,CAAE,CAAC;MAClE;MACA,MAAMc,KAAK,GAAGb,UAAU,CAACW,QAAQ,CAACG,GAAG,CAACC,GAAG,KAAK;QAAEC,GAAG,EAAED,GAAG,CAACC;MAAG,CAAE,CAAC,CAAC;MAChE,MAAMC,YAAY,GAAG,MAAMC,aAAa,CAAC;QACrC,GAAG/B,QAAQ;QACXe,cAAc,EAAEC,wBAAwB,CAACC,aAAa,CAACC,MAAM,CAAC;QAC9Db;MAChB,CAAa,EAAE;QACCc,MAAM,EAAElB,MAAM;QACd+B,MAAM,EAAE;UACJC,OAAO,EAAEP,KAAK;UACdQ,KAAK,EAAE;QAC3B,CAAiB;QACDX,mBAAmB,EAAEpB;MACrC,CAAa,CAAC;MACF,MAAMgC,OAAO,GAAGL,YAAY,CAACM,OAAO,EAAET,GAAG,CAACC,GAAG,KAAK;QAAES,IAAI,EAAET,GAAG,CAACC;MAAG,CAAE,CAAC,CAAC,IAAI,EAAE;MAC3E,MAAMS,MAAM,GAAGR,YAAY,CAACS,MAAM,EAAEZ,GAAG,CAACa,GAAG,KAAK;QAC5CH,IAAI,EAAEG,GAAG,CAACX,GAAG;QACbY,IAAI,EAAED,GAAG,CAACE,IAAI;QACd9B,OAAO,EAAE4B,GAAG,CAACG;MAC7B,CAAa,CAAC,CAAC,IAAI,EAAE;MACTnC,gBAAgB,CAAC;QAAE2B,OAAO;QAAEG;MAAM,CAAE,CAAC;MACrC7B,iBAAiB,GAAGI,UAAU,CAAC+B,qBAAqB;IACxD,CAAC,QAAQnC,iBAAiB;IAC1B,OAAO;MAAE4B,IAAI,EAAEnC;IAAS,CAAE;EAC9B,EACA,OAAO2C,KAAK,EAAE;IACV,IAAIxC,WAAW,EAAEK,OAAO,EAAE;MACtB,MAAM,IAAIC,aAAa,CAAC;QAAEC,OAAO,EAAE;MAAwB,CAAE,CAAC;IAClE;IACA,MAAMiC,KAAK;EACf;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}