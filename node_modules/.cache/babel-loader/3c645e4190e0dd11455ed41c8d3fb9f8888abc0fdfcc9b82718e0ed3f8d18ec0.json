{"ast":null,"code":"import { parseMetadata } from '@aws-amplify/core/internals/aws-client-utils';\nimport { AmplifyUrl, AmplifyUrlSearchParams } from '@aws-amplify/core/internals/utils';\nimport { composeServiceApi } from '@aws-amplify/core/internals/aws-client-utils/composers';\nimport { s3TransferHandler } from '../runtime/s3TransferHandler/fetch.mjs';\nimport 'fast-xml-parser';\nimport '../runtime/s3TransferHandler/xhr.mjs';\nimport 'buffer';\nimport { buildStorageServiceError } from '../utils/deserializeHelpers.mjs';\nimport { validateS3RequiredParameter, assignStringVariables } from '../utils/serializeHelpers.mjs';\nimport { generateDeleteObjectsXml } from '../../generateDeleteObjectsXml.mjs';\nimport { calculateContentMd5 } from '../../md5.mjs';\nimport { defaultConfig, parseXmlError } from './base.mjs';\n\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nconst deleteObjectsSerializer = async (input, endpoint) => {\n  const url = new AmplifyUrl(endpoint.url.toString());\n  validateS3RequiredParameter(!!input.Delete, 'Delete');\n  url.pathname = '/';\n  url.search = new AmplifyUrlSearchParams({\n    delete: ''\n  }).toString();\n  const body = generateDeleteObjectsXml(input.Delete.Objects, input.Delete.Quiet ?? false);\n  const contentMd5 = input.ContentMD5 ?? (await calculateContentMd5(body));\n  const headers = assignStringVariables({\n    'x-amz-expected-bucket-owner': input.ExpectedBucketOwner,\n    'content-type': 'application/xml',\n    'content-md5': contentMd5\n  });\n  const request = {\n    method: 'POST',\n    headers,\n    url,\n    body\n  };\n  return request;\n};\nconst deleteObjectsDeserializer = async response => {\n  if (response.statusCode >= 300) {\n    const error = await parseXmlError(response);\n    throw buildStorageServiceError(error);\n  }\n  const text = await response.body.text();\n  const deleted = [];\n  const errors = [];\n  const deletedMatches = text.matchAll(/<Deleted>[\\s\\S]*?<\\/Deleted>/g);\n  for (const match of deletedMatches) {\n    const keyMatch = match[0].match(/<Key>(.*?)<\\/Key>/);\n    if (keyMatch) {\n      deleted.push({\n        Key: keyMatch[1]\n      });\n    }\n  }\n  const errorMatches = text.matchAll(/<Error>[\\s\\S]*?<\\/Error>/g);\n  for (const match of errorMatches) {\n    const keyMatch = match[0].match(/<Key>(.*?)<\\/Key>/);\n    const codeMatch = match[0].match(/<Code>(.*?)<\\/Code>/);\n    const messageMatch = match[0].match(/<Message>(.*?)<\\/Message>/);\n    errors.push({\n      Key: keyMatch?.[1],\n      Code: codeMatch?.[1],\n      Message: messageMatch?.[1]\n    });\n  }\n  const result = {\n    Deleted: deleted,\n    Errors: errors,\n    $metadata: parseMetadata(response)\n  };\n  return result;\n};\nconst deleteObjects = composeServiceApi(s3TransferHandler, deleteObjectsSerializer, deleteObjectsDeserializer, {\n  ...defaultConfig,\n  responseType: 'text'\n});\nexport { deleteObjects };","map":{"version":3,"names":["deleteObjectsSerializer","input","endpoint","url","AmplifyUrl","toString","validateS3RequiredParameter","Delete","pathname","search","AmplifyUrlSearchParams","delete","body","generateDeleteObjectsXml","Objects","Quiet","contentMd5","ContentMD5","calculateContentMd5","headers","assignStringVariables","ExpectedBucketOwner","request","method","deleteObjectsDeserializer","response","statusCode","error","parseXmlError","buildStorageServiceError","text","deleted","errors","deletedMatches","matchAll","match","keyMatch","push","Key","errorMatches","codeMatch","messageMatch","Code","Message","result","Deleted","Errors","$metadata","parseMetadata","deleteObjects","composeServiceApi","s3TransferHandler","defaultConfig","responseType"],"sources":["/Users/mohamedhazin/Desktop/filevalut/frontend/node_modules/@aws-amplify/storage/src/providers/s3/utils/client/s3data/deleteObjects.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { parseMetadata, } from '@aws-amplify/core/internals/aws-client-utils';\nimport { AmplifyUrl, AmplifyUrlSearchParams, } from '@aws-amplify/core/internals/utils';\nimport { composeServiceApi } from '@aws-amplify/core/internals/aws-client-utils/composers';\nimport { assignStringVariables, buildStorageServiceError, s3TransferHandler, validateS3RequiredParameter, } from '../utils';\nimport { generateDeleteObjectsXml } from '../../generateDeleteObjectsXml';\nimport { calculateContentMd5 } from '../../md5';\nimport { defaultConfig, parseXmlError } from './base';\nconst deleteObjectsSerializer = async (input, endpoint) => {\n    const url = new AmplifyUrl(endpoint.url.toString());\n    validateS3RequiredParameter(!!input.Delete, 'Delete');\n    url.pathname = '/';\n    url.search = new AmplifyUrlSearchParams({\n        delete: '',\n    }).toString();\n    const body = generateDeleteObjectsXml(input.Delete.Objects, input.Delete.Quiet ?? false);\n    const contentMd5 = input.ContentMD5 ?? (await calculateContentMd5(body));\n    const headers = assignStringVariables({\n        'x-amz-expected-bucket-owner': input.ExpectedBucketOwner,\n        'content-type': 'application/xml',\n        'content-md5': contentMd5,\n    });\n    const request = {\n        method: 'POST',\n        headers,\n        url,\n        body,\n    };\n    return request;\n};\nconst deleteObjectsDeserializer = async (response) => {\n    if (response.statusCode >= 300) {\n        const error = await parseXmlError(response);\n        throw buildStorageServiceError(error);\n    }\n    const text = await response.body.text();\n    const deleted = [];\n    const errors = [];\n    const deletedMatches = text.matchAll(/<Deleted>[\\s\\S]*?<\\/Deleted>/g);\n    for (const match of deletedMatches) {\n        const keyMatch = match[0].match(/<Key>(.*?)<\\/Key>/);\n        if (keyMatch) {\n            deleted.push({ Key: keyMatch[1] });\n        }\n    }\n    const errorMatches = text.matchAll(/<Error>[\\s\\S]*?<\\/Error>/g);\n    for (const match of errorMatches) {\n        const keyMatch = match[0].match(/<Key>(.*?)<\\/Key>/);\n        const codeMatch = match[0].match(/<Code>(.*?)<\\/Code>/);\n        const messageMatch = match[0].match(/<Message>(.*?)<\\/Message>/);\n        errors.push({\n            Key: keyMatch?.[1],\n            Code: codeMatch?.[1],\n            Message: messageMatch?.[1],\n        });\n    }\n    const result = {\n        Deleted: deleted,\n        Errors: errors,\n        $metadata: parseMetadata(response),\n    };\n    return result;\n};\nexport const deleteObjects = composeServiceApi(s3TransferHandler, deleteObjectsSerializer, deleteObjectsDeserializer, { ...defaultConfig, responseType: 'text' });\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}